# @feature 模块测试

本目录包含针对 @feature 模块的测试用例，用于验证功能特性工具的正确性。

## 测试内容

- 向量嵌入测试：测试向量嵌入和相似度计算功能
- 向量HNSW索引测试：测试高性能近似最近邻搜索索引
- Delta-PQ压缩测试：测试向量压缩和高效距离计算功能
- 图像处理工具测试：测试图像处理相关功能
- 颜色处理工具测试：测试颜色转换和处理功能
- 数据结构工具测试：测试专用数据结构的功能
- 状态机测试：测试状态机的状态转换和事件处理
- 聊天功能测试：测试消息格式化和流处理功能
- OpenAI 接口测试：测试 OpenAI API 调用功能
- SVG 处理工具测试：测试 SVG 生成和处理功能
- Vue 组件工具测试：测试 Vue 组件加载和对话框功能

## 运行测试

在项目根目录执行：

```bash
node tests/feature/run.js
```

或者单独运行特定测试：

```bash
node tests/feature/向量嵌入测试.js
node tests/feature/向量HNSW索引测试.js
```

运行所有向量相关测试：

```bash
node tests/feature/运行向量测试.js
```

## 向量索引测试说明

向量索引测试主要验证以下功能：

1. HNSW索引的创建、插入、查询和删除功能
2. Delta-PQ向量压缩算法的训练、量化和反量化功能
3. 组合索引的性能与准确性平衡
4. 不同距离度量方式的结果差异
5. 大规模数据下的性能指标测试（可选）

测试会自动生成随机向量数据，不需要额外的数据集

# 特性测试目录

本目录包含了针对系统各项特性的测试文件，用于验证功能的正确性和性能表现。

## 向量搜索相关测试

### HNSW索引实现比较测试 (hnswlayers对比测试.js)

该测试比较了三种HNSW（分层可导航小世界图）实现的性能和准确性：
1. 自定义HNSW实现
2. 经典HNSW实现
3. NPM HNSW库实现（从esm.sh引入）

测试内容包括：
- 索引构建时间
- 查询性能（时间和召回率）
- 序列化/反序列化性能

执行方式：
```bash
node tests/feature/hnswlayers对比测试.js
```

### 向量嵌入测试 (向量嵌入测试.js)

测试向量嵌入功能，验证向量生成、存储和检索的准确性。

### 向量索引搜索放大测试 (向量索引搜索放大测试.mjs)

测试在大规模数据集上的向量索引搜索性能。

### 填充向量测试 (填充向量测试.js)

测试向量填充功能，用于向量缺失情况下的处理。

## 运行所有测试

可以通过以下命令运行所有特性测试：

```bash
for file in tests/feature/*.js; do node $file; done
```

## 注意事项

- 测试数据为随机生成，因此每次运行结果可能略有差异
- 大规模测试可能需要较长运行时间
- 某些测试可能需要较大内存，建议在资源充足的环境中运行 

## 部分结论

hnsw库没必要是使用,准确率和性能相比自行实现都没有优势