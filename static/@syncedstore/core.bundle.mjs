/* esm.sh - @syncedstore/core@0.6.0 */
var me=Object.defineProperty;var we=(e,t)=>{for(var r in t)me(e,r,{get:t[r],enumerable:!0})};var J={};we(J,{$reactive:()=>g,$reactiveproxy:()=>h,$skipreactive:()=>V,Atom:()=>re,Observer:()=>$,Reaction:()=>j,autorun:()=>Re,autorunAsync:()=>Se,createAtom:()=>Pe,hasRunningReaction:()=>L,isActionRunning:()=>H,isReactive:()=>E,isTrackingDisabled:()=>q,markRaw:()=>C,reaction:()=>xe,reactive:()=>_,runInAction:()=>z,runningReaction:()=>G,untracked:()=>Q,untrackedCB:()=>_e});function A(){return A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},A.apply(this,arguments)}function Oe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,K(e,t)}function K(e,t){return K=Object.setPrototypeOf||function(o,n){return o.__proto__=n,o},K(e,t)}function ve(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var $=function(){function e(r){this.trigger=r,this.observing=new Map}var t=e.prototype;return t.registerConnection=function(o){var n=this.observing.get(o.observable);n||(n={byKey:new Set,iterate:!1},this.observing.set(o.observable,n)),o.type==="iterate"?n.iterate=!0:n.byKey.add(o.key)},t.removeObservers=function(){var o=this;this.observing.forEach(function(n,s){n.iterate&&s[g].connections.iterate.delete(o),n.byKey.forEach(function(i){s[g].connections.byKey.get(i).delete(o)})}),this.observing.clear()},e}(),w=[],j=function(e){Oe(t,e);function t(o,n,s){var i;if(i=e.call(this,function(){return i._trigger()})||this,i.func=o,i.options=n,i.effect=s,i.isInitial=!0,i.reaction=function(){w.push(ve(i));try{i.func()}finally{w.pop()}i.effect&&(!i.isInitial||i.options.fireImmediately)&&i.effect(),i.isInitial=!1},!s&&!i.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return i.reaction(),i}var r=t.prototype;return r._trigger=function(){if(w.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},t}($);function L(){return!!w.length}function G(){return w.length?w[w.length-1]:void 0}function xe(e,t,r){var o=A({name:"unnamed",fireImmediately:!0},r),n=new j(e,o,t);return n}var D=0;function H(){return D>0}function z(e){D++;try{return e()}finally{D--,D===0&&Ae()}}var B=!1;function q(){return B}function Q(e){B=!0;try{e()}finally{B=!1}}function _e(e){return function(){return Q(e)}}var X=[];function Ae(){var e=[].concat(X);X=[],Z(e)}function Z(e){var t=new Set;e.forEach(function(r){var o;(r.type==="add"||r.type==="delete")&&r.observable[g].connections.iterate.forEach(function(n){t.add(n)}),(o=r.observable[g].connections.byKey.get(r.key))==null||o.forEach(function(n){t.add(n)})}),t.forEach(function(r){r.trigger()})}function k(e){if(H()){X.push(e);return}Z([e])}function U(e,t){if(e.type==="iterate")e.observable[g].connections.iterate.add(t);else{var r=e.observable[g].connections.byKey.get(e.key);r||(r=new Set,e.observable[g].connections.byKey.set(e.key,r)),r.add(t)}}function T(e,t){if(!q()){var r=G();r&&(U(e,r),r.registerConnection(e)),t&&(U(e,t),t.registerConnection(e))}}var V=Symbol("$skipreactive"),g=Symbol("$reactive"),h=Symbol("$reactiveproxy");function E(e,t){return!!(e&&e[h]&&e[h].implicitObserver===t)}function C(e){return e[V]=!0,e}function ee(e){return!!(e&&!E(e)&&e[g])}function F(e,t,r){if(r===void 0&&(r=!1),e[V]||E(e,t))return e;var o=Ee(e,r);if(!t)return o;var n=o[g].proxiesWithImplicitObserver.get(t);if(!n){var s={implicitObserver:t};Object.setPrototypeOf(s,te),n=new Proxy(o[g].raw,s),o[g].proxiesWithImplicitObserver.set(t,n)}return n}var _=F;function Ee(e,t){if(t===void 0&&(t=!1),E(e))return e;if(ee(e))return e[g].proxy;if(e[g]||e[h])throw new Error("unexpected");var r={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:e,proxiesWithImplicitObserver:new Map,shallow:t};Object.defineProperty(e,g,{enumerable:!1,writable:!0,configurable:!0,value:r});var o=new Proxy(e,te);return r.proxy=o,o}var te={has:function(t,r){var o=Reflect.has(t,r);return typeof r=="symbol"||T({observable:t,key:r,type:"has"},this.implicitObserver),o},get:function(t,r,o){if(r===h)return{implicitObserver:this.implicitObserver};var n=Reflect.get(t,r,o);if(typeof r=="symbol")return r.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),n;if(r==="length"&&Array.isArray(t)?T({observable:t,type:"iterate"},this.implicitObserver):T({observable:t,key:r,type:"get"},this.implicitObserver),ee(n))return F(n,this.implicitObserver);if(t[g].shallow)return n;if(typeof n=="object"&&n!==null&&!E(n,this.implicitObserver)&&!Object.isFrozen(n)){var s=Reflect.getOwnPropertyDescriptor(t,r);if((!s||!(s.writable===!1&&s.configurable===!1))&&(L()||this.implicitObserver))return F(n,this.implicitObserver)}return n},ownKeys:function(t){return T({observable:t,type:"iterate"},this.implicitObserver),Reflect.ownKeys(t)},set:function(t,r,o,n){return z(function(){if(typeof r=="symbol")return Reflect.set(t,r,o,n);var s=Object.hasOwnProperty.call(t,r),i=Reflect.get(t,r,n),f=Reflect.set(t,r,o,n);if(!s)k({observable:t,key:r,value:o,type:"add"});else if(o!==i)if(r==="length"&&Array.isArray(t)){if(!(i<o))for(var a=o+1;a<=i;a++)k({observable:t,key:""+(a-1),oldValue:void 0,type:"delete"})}else k({observable:t,key:r,value:o,oldValue:i,type:"update"});return f})},deleteProperty:function(t,r){return z(function(){if(typeof r=="symbol")return Reflect.deleteProperty(t,r);var o=Object.hasOwnProperty.call(t,r),n=Reflect.get(t,r),s=Reflect.deleteProperty(t,r);return o&&k({observable:t,key:r,oldValue:n,type:"delete"}),s})},preventExtensions:function(t){throw new Error("Dynamic observable objects cannot be frozen")}};function Re(e,t){var r=A({name:"unnamed",fireImmediately:!0},t),o=new j(e,r);return o}function Se(e,t,r){var o=A({name:"unnamed",fireImmediately:!0},r),n=new j(function(){e(t)},o);return t=_(t,n),o.fireImmediately&&n.trigger(),n}var re=function(){function e(){this._observable=_({_key:1})}var t=e.prototype;return t.reportObserved=function(o){return _(this._observable,o)._key},t.reportChanged=function(){this._observable._key++},e}();function Pe(e,t,r){return new re}import*as b from"../yjs.js";var R,S,Ye=e=>e();function ke(e,t){if(S)return S(e,t);Ye(e)}function O(e,t,r){if(R)return R.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function Te(e){R=e.createAtom,S=void 0}function De(e){R=function(t,r){let o=0,n=e.reactive({data:o}),s={reportObserved(){return n.data},reportChanged(){n.data=++o}};return r&&r(),s},S=void 0}function ye(e){R=function(t,r,o){let n=e.createAtom(t);return r&&r(),n},S=(t,r)=>e.reaction(t,r,{fireImmediately:!1})}var ne=new WeakSet;function je(e){if(ne.has(e))return e;ne.add(e);let t,r=new Map;function o(){if(!t){let c=l=>{(l.changes.added.size||l.changes.deleted.size||l.changes.keys.size||l.changes.delta.length)&&t.reportChanged()};t=O("map",()=>{e.observe(c)},()=>{e.unobserve(c)})}t.reportObserved(e._implicitObserver)}function n(c){let l=r.get(c);if(!l){let y=m=>{l.reportChanged()};l=O(c+"",()=>{e.observe(y)},()=>{e.unobserve(y)}),r.set(c,l)}l.reportObserved(e._implicitObserver)}let s=e.get;e.get=function(c){if(typeof c!="number")throw new Error("unexpected");return n(c),Reflect.apply(s,this,arguments)};function i(c){let l=e[c];e[c]=function(){return o(),Reflect.apply(l,this,arguments)}}function f(c){let l=e,y=Object.getOwnPropertyDescriptor(l,c);if(y||(l=Object.getPrototypeOf(l),y=Object.getOwnPropertyDescriptor(l,c)),y||(l=Object.getPrototypeOf(l),y=Object.getOwnPropertyDescriptor(l,c)),!y)throw new Error("property not found");let m=y.get;y.get=function(){return this._disableTracking||o(),Reflect.apply(m,this,arguments)},Object.defineProperty(e,c,y)}function a(c,l){let y=e,m=Object.getOwnPropertyDescriptor(y,c);if(m||(y=Object.getPrototypeOf(y),m=Object.getOwnPropertyDescriptor(y,c)),m||(y=Object.getPrototypeOf(y),m=Object.getOwnPropertyDescriptor(y,c)),!m)throw new Error("property not found");Object.defineProperty(e,l,m)}i("forEach"),i("toJSON"),i("toArray"),i("slice"),i("map"),a("length","lengthUntracked"),f("length");let d=e.push;e.push=function(c){this._disableTracking=!0;let l=d.call(this,c);return this._disableTracking=!1,l};let p=e.slice;return e.slice=function(c,l){this._disableTracking=!0;let y=p.call(this,c,l);return this._disableTracking=!1,y},e}var ie=new WeakSet;function Ce(e){if(ie.has(e))return e;ie.add(e);let t;function r(){if(!t){let s=Array.from(e.share.keys()),i=f=>{let a=Array.from(e.share.keys());JSON.stringify(s)!==JSON.stringify(a)&&(s=a,t.reportChanged())};t=O("map",()=>{e.on("beforeObserverCalls",i)},()=>{e.off("beforeObserverCalls",i)})}t.reportObserved(e._implicitObserver)}let o=e.get;e.get=function(s){if(typeof s!="string")throw new Error("unexpected");let i=Reflect.apply(o,this,arguments);return I(i),i};function n(s){let i=e[s],f;e[s]=function(){let a,d=arguments;return r(),f&&f.removeObservers(),f=ke(()=>(a=Reflect.apply(i,e,d),a),()=>t.reportChanged()),a}}return n("toJSON"),Object.defineProperty(e,"keys",{get:()=>(r(),Object.keys(e.share))}),e}var oe=new WeakSet;function Ie(e){if(oe.has(e))return e;oe.add(e);let t,r=new Map;function o(){if(!t){let f=a=>{(a.changes.added.size||a.changes.deleted.size||a.changes.keys.size||a.changes.delta.length)&&t.reportChanged()};t=O("map",()=>{e.observe(f)},()=>{e.unobserve(f)})}t.reportObserved(e._implicitObserver)}function n(f){let a=r.get(f);if(!a){let d=p=>{p.keysChanged.has(f)&&(p.changes.added.size||p.changes.deleted.size||p.changes.keys.size||p.changes.delta.length)&&a.reportChanged()};a=O(f,()=>{e.observe(d)},()=>{e.unobserve(d)}),r.set(f,a)}a.reportObserved(e._implicitObserver)}let s=e.get;e.get=function(f){if(typeof f!="string")throw new Error("unexpected");return n(f),Reflect.apply(s,this,arguments)};function i(f){let a=e[f];e[f]=function(){return o(),Reflect.apply(a,this,arguments)}}return i("values"),i("entries"),i("keys"),i("forEach"),i("toJSON"),e}var se=new WeakSet;function fe(e){if(se.has(e))return e;se.add(e);let t,r=n=>{t.reportChanged()};t=O("text",()=>{e.observe(r)},()=>{e.unobserve(r)});function o(n){let s=e[n];e[n]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return o("toString"),o("toJSON"),e}var ae=new WeakSet;function ce(e){if(ae.has(e))return e;ae.add(e);let t,r=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&t.reportChanged()};t=O("xml",()=>{e.observe(r)},()=>{e.unobserve(r)});function o(s){let i=e[s];e[s]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(i,this,arguments)}}function n(s){let i=e,f=Object.getOwnPropertyDescriptor(i,s);if(f||(i=Object.getPrototypeOf(i),f=Object.getOwnPropertyDescriptor(i,s)),f||(i=Object.getPrototypeOf(i),f=Object.getOwnPropertyDescriptor(i,s)),!f)throw new Error("property not found");let a=f.get;f.get=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(a,this,arguments)},Object.defineProperty(e,s,f)}return o("toString"),o("toDOM"),o("toArray"),o("getAttribute"),n("firstChild"),e}function I(e){return e instanceof b.XmlText||e instanceof b.Text?fe(e):e instanceof b.Array?je(e):e instanceof b.Map?Ie(e):e instanceof b.Doc||Object.prototype.hasOwnProperty.call(e,"autoLoad")?Ce(e):e instanceof b.XmlFragment||e instanceof b.XmlElement?ce(e):e}function ue(e){e.share.forEach(t=>{t.constructor!==b.AbstractType&&I(t)})}function le(e,t){for(let o=e.length-1;o>=t;o--){let n=e[o];if(!n.deleted){var r;if(n instanceof b.GC)continue;(r=n.content)==null||r.getContent().forEach(s=>{s instanceof b.AbstractType&&I(s)})}}}var pe=new WeakSet;function be(e){pe.has(e)||(pe.add(e),I(e),e.store.clients.forEach(t=>{t&&le(t,0)}),ue(e),e.on("beforeObserverCalls",t=>{ue(e),t.afterState.forEach((r,o)=>{let n=t.beforeState.get(o)||0;if(n!==r){let s=t.doc.store.clients.get(o);if(!s)return;let i=b.findIndexSS(s,n);le(s,i)}})}))}import*as u from"../yjs.js";import{Array as et,Doc as tt,Map as rt,Text as nt,XmlFragment as it}from"../yjs.js";var v=class{constructor(t){this.value=void 0,this.value=t}};function Me(e){return ArrayBuffer.isView(e)?new v(e):new v(Object.freeze(e))}function Ne(e){let t=function(){var f;let a=(f=this[h])==null?void 0:f.implicitObserver;return e._implicitObserver=a,e.slice.bind(e).apply(e,arguments).map(p=>{let c=M(p,a);return a&&typeof c=="object"?_(c,a):c})},r=function(f){return f.map(a=>{let d=W(a),p=x(d)||d;if(p instanceof v&&(p=p.value),p instanceof u.AbstractType&&p.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return p})},o=function(){return[].findIndex.apply(t.apply(this),arguments)},n={slice:t,unshift:(...i)=>(e.unshift(r(i)),e.lengthUntracked),push:(...i)=>(e.push(r(i)),e.lengthUntracked),insert:e.insert.bind(e),toJSON:e.toJSON.bind(e),forEach:function(){return[].forEach.apply(t.apply(this),arguments)},every:function(){return[].every.apply(t.apply(this),arguments)},filter:function(){return[].filter.apply(t.apply(this),arguments)},find:function(){return[].find.apply(t.apply(this),arguments)},findIndex:o,some:function(){return[].some.apply(t.apply(this),arguments)},includes:function(){return[].includes.apply(t.apply(this),arguments)},map:function(){return[].map.apply(t.apply(this),arguments)},indexOf:function(){let i=arguments[0];return o.call(this,f=>Xe(f,i))},splice:function(){let i=arguments[0]<0?e.length-Math.abs(arguments[0]):arguments[0],f=arguments[1],a=Array.from(Array.from(arguments).slice(2)),d=t.apply(this,[i,Number.isInteger(f)?i+f:void 0]);return e.doc?e.doc.transact(()=>{e.delete(i,f),e.insert(i,r(a))}):(e.delete(i,f),e.insert(i,r(a))),d}},s=[];for(let i in n)s[i]=n[i];return s}function P(e){if(typeof e=="string"&&e.trim().length){let t=Number(e);if(Number.isInteger(t))return t}return e}function ge(e,t=new u.Array){if(t[g])throw new Error("unexpected");let r=Ne(t),o=new Proxy(r,{set:(n,s,i)=>{throw typeof P(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(n,s,i)=>{let f=P(s);if(f===N)return t;if(typeof f=="number"){let p;if(i&&i[h]){var a;p=(a=i[h])==null?void 0:a.implicitObserver,t._implicitObserver=p}let c=t.get(f);return c=M(c,p),c}if(f===Symbol.toStringTag)return"Array";if(f===Symbol.iterator){let p=t.slice();return Reflect.get(p,f)}return f==="length"?t.length:Reflect.get(n,f,i)},deleteProperty:(n,s)=>{let i=P(s);if(typeof i!="number")throw new Error;return i<t.lengthUntracked&&i>=0?(t.delete(i),!0):!1},has:(n,s)=>{let i=P(s);return typeof i!="number"?Reflect.has(n,i):i<t.lengthUntracked&&i>=0},getOwnPropertyDescriptor(n,s){let i=P(s);if(i==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof i=="number"&&i>=0&&i<t.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:n=>{let s=[];for(let i=0;i<t.length;i++)s.push(i+"");return s.push("length"),s}});return r.push.apply(o,e),o}function de(e,t=new u.Map){if(t[g])throw new Error("unexpected");let r=new Proxy({},{set:(o,n,s)=>{if(typeof n!="string")throw new Error;let i=W(s),f=x(i)||i;if(f instanceof v&&(f=f.value),f instanceof u.AbstractType&&f.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return t.set(n,f),!0},get:(o,n,s)=>{if(n===N)return t;if(typeof n!="string")return Reflect.get(o,n);let i;if(s&&s[h]){var f;i=(f=s[h])==null?void 0:f.implicitObserver,t._implicitObserver=i}let a=t.get(n);return a=M(a,i),a},deleteProperty:(o,n)=>{if(typeof n!="string")throw new Error;return t.has(n)?(t.delete(n),!0):!1},has:(o,n)=>!!(typeof n=="string"&&t.has(n)),getOwnPropertyDescriptor(o,n){if(typeof n=="string"&&t.has(n))return{enumerable:!0,configurable:!0}},ownKeys:o=>Array.from(t.keys())});Y.set(t,r);for(let o in e)r[o]=e[o];return r}function Ke(e){return e instanceof u.AbstractType}var Y=new WeakMap;function M(e,t){if(Ke(e)){if(e._implicitObserver=t,e instanceof u.Array||e instanceof u.Map){if(!Y.has(e)){let r=W(e);Y.set(e,r)}e=Y.get(e)}else if(e instanceof u.XmlElement||e instanceof u.XmlFragment||e instanceof u.XmlText||e instanceof u.XmlHook||e instanceof u.Text)C(e),e.__v_skip=!0;else throw new Error("unknown YType");return e}else{if(e===null)return null;if(typeof e=="object")return Me(e)}return e}function W(e){if(e==null)return e;if(e=x(e)||e,e instanceof u.Array)return ge([],e);if(e instanceof u.Map)return de({},e);if(typeof e=="string")return e;if(Array.isArray(e))return ge(e);if(e instanceof u.XmlElement||e instanceof u.XmlFragment||e instanceof u.XmlText||e instanceof u.XmlHook)return e;if(e instanceof u.Text)return e;if(typeof e=="object")return e instanceof v?e:de(e);if(typeof e=="number"||typeof e=="boolean")return e;throw new Error("invalid")}function ze(e){for(let[t,r]of Object.entries(e))if(Array.isArray(r)){if(r.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(r&&typeof r=="object"){if(Object.keys(r).length!==0||Object.getPrototypeOf(r)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(r!=="xml"&&r!=="text")throw new Error("unknown Root initializer")}function he(e,t,r){let o=t[r];if(!o){r!=="__v_raw"&&r!=="__v_isRef"&&r!=="__v_isReadonly"&&console.warn("property not found on root doc",r);return}return o==="xml"?e.getXmlFragment(r):o==="text"?e.getText(r):Array.isArray(o)?e.getArray(r):e.getMap(r)}function Be(e,t){if(e[g])throw new Error("unexpected");ze(t);let r=new Proxy({},{set:(o,n,s)=>{throw typeof n!="string"?new Error:new Error("cannot set new elements on root doc")},get:(o,n,s)=>{if(n===N)return e;if(typeof n!="string")return Reflect.get(o,n);let i;if(s&&s[h]){var f;i=(f=s[h])==null?void 0:f.implicitObserver,e._implicitObserver=i}if(n==="toJSON"){for(let p of Object.keys(t))he(e,t,p);return Reflect.get(e,n)}let a=he(e,t,n);return a=M(a,i),a},deleteProperty:(o,n)=>{throw new Error("deleteProperty not available for doc")},has:(o,n)=>!!(typeof n=="string"&&e.share.has(n)),getOwnPropertyDescriptor(o,n){if(typeof n=="string"&&e.share.has(n)||n==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:o=>Array.from(e.share.keys())});return Y.set(e,r),r}function $e(e,t){for(let r=e.length-1;r>=0;r--)t(e[r])||e.splice(r,1)}ye(J);var N=Symbol("INTERNAL_SYMBOL");function Le(e,t){let r=x(e)||e;if(!r)throw new Error("not a valid synced object");return r instanceof u.Doc?(r.on("update",t),()=>{r.off("update",t)}):(r.observeDeep(t),()=>{r.unobserveDeep(t)})}function Ge(e){let t=x(e);if(!(t instanceof u.Doc))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return t}function x(e){if(typeof e!="object"||e===null)return;let t=e[N];return t&&(C(t),t.__v_skip=!0),t}function Xe(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){let r=x(e),o=x(t);return!r||!o?!1:r===o}return!1}function He(e,t=new u.Doc){return be(t),Be(t,e)}export{v as Box,N as INTERNAL_SYMBOL,et as SyncedArray,tt as SyncedDoc,rt as SyncedMap,nt as SyncedText,it as SyncedXml,u as Y,Xe as areSame,Me as boxed,He as default,Te as enableMobxBindings,De as enableVueBindings,$e as filterArray,Ge as getYjsDoc,x as getYjsValue,Le as observeDeep,He as syncedStore};
//# sourceMappingURL=core.bundle.mjs.map