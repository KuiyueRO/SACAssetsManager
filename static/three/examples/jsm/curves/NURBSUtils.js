/* esm.sh - esbuild bundle(three@0.169.0/examples/jsm/curves/NURBSUtils) es2022 production */
import{Vector3 as D,Vector4 as B}from"../../../three.mjs";function z(e,r,n){let a=n.length-e-1;if(r>=n[a])return a-1;if(r<=n[e])return e;let c=e,l=a,s=Math.floor((c+l)/2);for(;r<n[s]||r>=n[s+1];)r<n[s]?l=s:c=s,s=Math.floor((c+l)/2);return s}function g(e,r,n,a){let c=[],l=[],s=[];c[0]=1;for(let o=1;o<=n;++o){l[o]=r-a[e+1-o],s[o]=a[e+o]-r;let m=0;for(let v=0;v<o;++v){let f=s[v+1],t=l[o-v],i=c[v]/(f+t);c[v]=m+f*i,m=t*i}c[o]=m}return c}function R(e,r,n,a){let c=z(e,a,r),l=g(c,a,e,r),s=new B(0,0,0,0);for(let o=0;o<=e;++o){let m=n[c-e+o],v=l[o],f=m.w*v;s.x+=m.x*f,s.y+=m.y*f,s.z+=m.z*f,s.w+=m.w*v}return s}function K(e,r,n,a,c){let l=[];for(let t=0;t<=n;++t)l[t]=0;let s=[];for(let t=0;t<=a;++t)s[t]=l.slice(0);let o=[];for(let t=0;t<=n;++t)o[t]=l.slice(0);o[0][0]=1;let m=l.slice(0),v=l.slice(0);for(let t=1;t<=n;++t){m[t]=r-c[e+1-t],v[t]=c[e+t]-r;let i=0;for(let d=0;d<t;++d){let u=v[d+1],w=m[t-d];o[t][d]=u+w;let S=o[d][t-1]/o[t][d];o[d][t]=i+u*S,i=w*S}o[t][t]=i}for(let t=0;t<=n;++t)s[0][t]=o[t][n];for(let t=0;t<=n;++t){let i=0,d=1,u=[];for(let w=0;w<=n;++w)u[w]=l.slice(0);u[0][0]=1;for(let w=1;w<=a;++w){let S=0,y=t-w,j=n-w;t>=w&&(u[d][0]=u[i][0]/o[j+1][y],S=u[d][0]*o[y][j]);let N=y>=-1?1:-y,x=t-1<=j?w-1:n-t;for(let h=N;h<=x;++h)u[d][h]=(u[i][h]-u[i][h-1])/o[j+1][y+h],S+=u[d][h]*o[y+h][j];t<=j&&(u[d][w]=-u[i][w-1]/o[j+1][t],S+=u[d][w]*o[t][j]),s[w][t]=S;let k=i;i=d,d=k}}let f=n;for(let t=1;t<=a;++t){for(let i=0;i<=n;++i)s[t][i]*=f;f*=n-t}return s}function P(e,r,n,a,c){let l=c<e?c:e,s=[],o=z(e,a,r),m=K(o,a,e,l,r),v=[];for(let f=0;f<n.length;++f){let t=n[f].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,v[f]=t}for(let f=0;f<=l;++f){let t=v[o-e].clone().multiplyScalar(m[f][0]);for(let i=1;i<=e;++i)t.add(v[o-e+i].clone().multiplyScalar(m[f][i]));s[f]=t}for(let f=l+1;f<=c+1;++f)s[f]=new B(0,0,0);return s}function A(e,r){let n=1;for(let c=2;c<=e;++c)n*=c;let a=1;for(let c=2;c<=r;++c)a*=c;for(let c=2;c<=e-r;++c)a*=c;return n/a}function F(e){let r=e.length,n=[],a=[];for(let l=0;l<r;++l){let s=e[l];n[l]=new D(s.x,s.y,s.z),a[l]=s.w}let c=[];for(let l=0;l<r;++l){let s=n[l].clone();for(let o=1;o<=l;++o)s.sub(c[l-o].clone().multiplyScalar(A(l,o)*a[o]));c[l]=s.divideScalar(a[0])}return c}function b(e,r,n,a,c){let l=P(e,r,n,a,c);return F(l)}function I(e,r,n,a,c,l,s,o){let m=z(e,l,n),v=z(r,s,a),f=g(m,l,e,n),t=g(v,s,r,a),i=[];for(let u=0;u<=r;++u){i[u]=new B(0,0,0,0);for(let w=0;w<=e;++w){let S=c[m-e+w][v-r+u].clone(),y=S.w;S.x*=y,S.y*=y,S.z*=y,i[u].add(S.multiplyScalar(f[w]))}}let d=new B(0,0,0,0);for(let u=0;u<=r;++u)d.add(i[u].multiplyScalar(t[u]));d.divideScalar(d.w),o.set(d.x,d.y,d.z)}function V(e,r,n,a,c,l,s,o,m,v,f){let t=z(e,o,a),i=z(r,m,c),d=z(n,v,l),u=g(t,o,e,a),w=g(i,m,r,c),S=g(d,v,n,l),y=[];for(let N=0;N<=n;++N){y[N]=[];for(let x=0;x<=r;++x){y[N][x]=new B(0,0,0,0);for(let k=0;k<=e;++k){let h=s[t-e+k][i-r+x][d-n+N].clone(),C=h.w;h.x*=C,h.y*=C,h.z*=C,y[N][x].add(h.multiplyScalar(u[k]))}}}let j=new B(0,0,0,0);for(let N=0;N<=n;++N)for(let x=0;x<=r;++x)j.add(y[N][x].multiplyScalar(S[N]).multiplyScalar(w[x]));j.divideScalar(j.w),f.set(j.x,j.y,j.z)}export{P as calcBSplineDerivatives,R as calcBSplinePoint,K as calcBasisFunctionDerivatives,g as calcBasisFunctions,A as calcKoverI,b as calcNURBSDerivatives,F as calcRationalCurveDerivatives,I as calcSurfacePoint,V as calcVolumePoint,z as findSpan};
//# sourceMappingURL=NURBSUtils.js.map