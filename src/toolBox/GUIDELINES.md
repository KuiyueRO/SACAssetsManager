# ToolBox 开发与重构指南

本文档旨在规范 `src/toolBox` 目录下的代码开发、重构和维护活动，确保工具箱的清晰性、可维护性和可扩展性。

## 核心架构

工具箱采用三层架构，各层职责明确：

- **`base/`**: 存放最核心、通用的基础工具，按**技术或底层概念**组织。
- **`feature/`**: 存放基于`base`构建的、具有**特定技术能力或独立功能**的模块。
- **`useAge/`** (`domains/`, `tasks/`, `applications/`): **严格按照应用领域或任务类型**组织，解决具体场景问题。

详细的分层职责说明，特别是 `feature` 与 `domain` 的划分原则，请参阅：[./architecture_layers_explained.md](./architecture_layers_explained.md)

## 重构原则

1.  **最小改动**:
    *   创建兼容层以保持现有代码可用。
    *   保留原函数名导出，添加中文命名版本。
2.  **函数式风格** & **纯函数优先**:
    *   尽可能使用纯函数设计。
    *   避免副作用和状态依赖。
    *   确保函数输出只依赖输入。
    *   避免使用类，除非必要。
    *   减少嵌套。
3.  **单一职责**:
    *   每个函数专注于单一任务。
    *   避免功能过于复杂。
    *   促进代码复用。
4.  **合理抽象**:
    *   提供适当抽象级别。
    *   封装复杂实现细节。
    *   提供简洁清晰的接口。
5.  **命名规范**:
    *   **核心原则:** 遵循项目根目录定义的 [**编码风格指南**](../../CODING_STYLE.md#命名规范-naming-conventions)。
    *   **强调:** 在 `toolBox` 模块内，尤其注意文件名的语义化，**禁止**使用 `index.js` 或 `main.js`。
6.  **模块化设计**:
    *   按功能域组织工具。
    *   相关功能放在同一目录。
    *   文件过长时及时拆分。
7.  **错误处理**:
    *   提供明确的错误处理机制。
    *   返回有意义的错误信息。
    *   支持错误恢复策略 (如果适用)。

## 文件夹规范

**目标:** 确保 `toolBox` 内每个功能性文件夹都有明确的职责范围和代码准入标准。

**要求:**
- **强制性:** `toolBox` 下的**每一个**功能性子文件夹（无论位于 `base`, `feature`, `useAge`/`domain` 哪一层）都**必须**包含一个 `README.md` 或 `AInote.md` 文件。
- **内容:** 该文件必须清晰地：
    1.  **定义该文件夹的职责范围 (Scope):** 说明这个文件夹里的代码是用来做什么的。
    2.  **明确代码准入标准 (Criteria):** 根据 `toolBox` 的整体三层架构（Base/Feature/Domain），说明什么样的代码**才被允许**放在这个文件夹里。例如，明确指出它属于哪一层，以及它应该（或不应该）依赖哪些其他模块。
    3.  **链接总纲:** 必须包含指向 `toolBox` 根目录下架构说明文件 `[architecture_layers_explained.md](./architecture_layers_explained.md)` 的链接，作为统一的架构指导。
- **示例:** （在具体文件夹的 `README.md` 或 `AInote.md` 中）
    ```markdown
    # 文件夹名称 (例如: base/lang/functions)

    **所属层级:** Base

    **职责范围:** 提供与 ECMAScript 函数相关的底层、通用工具，如函数组合、柯里化、节流、防抖等。

    **准入标准:**
    - 必须是纯粹的、与函数操作相关的底层工具。
    - 必须无副作用（除非明确标记并隔离）。
    - **禁止**依赖 `feature` 或 `domain` 层的任何模块。
    - **禁止**包含特定应用的业务逻辑。
    - 外部依赖必须通过 `base/deps` 引入。

    **架构总纲:** [../../../architecture_layers_explained.md](../../../architecture_layers_explained.md) (根据实际层级调整路径)
    ```
- **维护:** 创建新文件夹或对文件夹职责进行重大调整时，必须同步创建或更新对应的说明文件。

## 导入导出规范

**核心目标:** 确保工具箱作为长期个人代码库的清晰性、可维护性和可扩展性。

**规范:**
- **严格禁止** 使用 `import *` 和 `export *`。
- **放弃** `*Exports.js` 等桶文件作为主要的模块导出方式。
- **强制** 使用**命名导出** (`export const func = ...;`)，禁止默认导出 (`export default`)。
- **强制** 使用**明确、直接的相对路径**进行模块导入：
    - 层内导入: `import { util } from '../anotherModule/util.js';`
    - 跨层导入: `import { baseFunc } from '../../base/someModule/file.js';`
    - 外部导入: (推荐配置路径别名如 `@toolBox/`) `import { tool } from '@toolBox/feature/someTool/index.js';`
- **优点:** 依赖清晰、利于 Tree Shaking、重构友好、避免循环依赖陷阱。
- **接受:** 导入路径可能变长，可通过路径别名缓解。

## 外部依赖管理原则 (`useDeps`)

**核心原则:** 项目的所有外部依赖（来自 `node_modules` 或 `static`）**必须**通过 [`./base/useDeps`](./base/useDeps) 目录进行统一引入和封装。其他任何模块（包括 `feature` 和 `useAge`）**禁止**直接引入外部依赖。

**目标:**
*   集中管理依赖版本。
*   提供稳定的内部接口，隔离外部变化。
*   简化依赖追踪和维护。

**详情参见:**
*   `base` 目录 AInote.md 中关于依赖管理的说明 (请在对应文件查找)。 