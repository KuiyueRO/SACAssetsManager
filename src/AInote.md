# 本区块由开发者编写,未经授权禁止助手改动

src中toolbox层的代码除了特定的useSiyuan之外,不应该有对思源环境的依赖
包括项目中其它所有地方对思源宿主环境的特殊依赖都应该封装到这里处理



# 源代码重构笔记

## 重构状态

项目源代码目录正在进行全面重构，以提高代码质量、可维护性和可扩展性。

## 职责范围

- 包含项目的所有核心源代码
- 按功能层次和模块组织代码
- 提供清晰的代码结构和依赖关系

## 重构原则

1. **分层清晰**：
   - 工具层、服务层、中间件层、模块层职责明确
   - 层与层之间通过明确的接口通信
   - 避免跨层越级调用

2. **依赖合理**：
   - 依赖方向自上而下（模块依赖服务，服务依赖工具）
   - 避免循环依赖
   - 通过依赖注入解耦组件

3. **功能内聚**：
   - 相关功能集中在同一模块
   - 每个文件职责单一
   - 避免过大的文件和过深的嵌套

4. **接口统一**：
   - 相似功能提供统一接口
   - 保持API风格一致
   - 提供良好的类型定义和文档

## 命名规范

### 中英文混合命名策略

项目采用中英文混合命名策略，根据不同场景选择最合适的命名方式：

1. **适合使用中文命名的场景**：
   - 业务逻辑函数（如`处理笔记内容`、`获取资源列表`）
   - 复杂算法和数学计算（如`计算余弦相似度`、`归一化向量`）
   - 特定于中文环境的功能（如`转换为简体中文`）
   - 需要详细表达的复杂概念

2. **适合使用英文命名的场景**：
   - 工具箱底层函数（如`debounce`、`throttle`）
   - 与外部库交互的接口（如`fetchData`、`renderComponent`）
   - 常见的编程模式（如`map`、`filter`、`reduce`）
   - 技术术语（如`HTTP`、`async`、`Promise`相关函数）

3. **混合命名规则**：
   - 保持单一文件内命名风格一致
   - 同一模块内尽量使用一致的命名风格
   - 函数名使用动词+名词结构，无论中英文
   - 变量名使用名词或形容词+名词结构

4. **命名转换对照表**：
   在必要时为常用函数提供中英文双名称，通过导出别名实现：
   ```javascript
   export const 计算余弦相似度 = calculateCosineSimilarity;
   export { 计算余弦相似度 as calculateCosineSimilarity };
   ```

5. **避免使用中英文混合的单个标识符**：
   - 好：`计算向量距离` 或 `calculateVectorDistance`
   - 差：`计算VectorDistance` 或 `Calculate向量Distance`

## 重构进度

- ✅ 工具箱 (toolBox) - 重构进行中，已完成框架设计
- ⏳ 服务 (services) - 计划中，等待工具箱基础能力就绪
- ⏳ 中间件 (middlewares) - 计划中，需要在服务层完成后推进
- ⏳ 功能模块 (modules) - 计划中，最后阶段实施

## 待处理事项

1. 工具箱重构：
   - 完成思源相关工具的重构
   - 完成文件系统相关工具的重构
   - 统一工具箱的导出接口

2. 服务层规划：
   - 梳理现有业务功能，设计服务抽象
   - 实现核心服务组件
   - 建立服务注册和发现机制

3. 中间件层规划：
   - 设计通用中间件框架
   - 实现核心中间件组件
   - 提供中间件组合机制

4. 模块层重构：
   - 按业务功能重新组织模块
   - 梳理模块间依赖关系
   - 实现基于服务的模块化设计

## 注意事项

- 重构过程中保持兼容性，避免破坏现有功能
- 采用渐进式重构，而非一次性大规模改造
- 添加适当的测试确保重构不引入新问题
- 及时更新文档反映最新的代码结构

## 历史记录

### 2023-12-10
- 建立src目录的整体重构框架
- 确定分层设计和依赖管理原则

### 2023-10-15
- 开始工具箱重构
- 建立工具箱的三层分类设计

### 2023-08-01
- 启动代码重构计划
- 进行代码结构分析和重构规划

# 这个区段由开发者编写,未经允许禁止AI修改
<开发者将会在这里提出要求,AI需要判断并满足这些要求>

# 项目导航索引

## 阅读进度摘要

1. [**项目初步阅读**](AInote-阅读进度.md) - 初步阅读和插件结构分析
2. [**工具箱模块分析**](toolBox-阅读分析.md) - 工具箱模块结构和功能分析
3. [**全局状态管理**](全局状态管理-阅读分析.md) - 全局状态管理机制和实现方式
4. [**事件系统分析**](事件系统-阅读分析.md) - 事件系统的设计与实现
5. [**商业化思考**](商业化思考.md) - 插件商业化可能性分析
6. [**其它未分析功能**](其它未分析功能.md) - REI/MAGI系统、国际化和服务器模块

## 搜索关键词

### 核心功能
- `插件初始化` - 插件的启动和初始化流程
- `工具箱` - 模块化工具集合
- `全局状态` - 全局状态管理机制
- `事件系统` - 事件监听和触发
- `服务器模块` - 插件内部服务器实现
- `国际化` - 多语言支持系统

### 特色功能
- `REI/MAGI系统` - AI辅助分析模块
- `AI翻译` - 基于OpenAI的翻译功能
- `心跳检测` - 服务可靠性保障机制

### Vue组件
- `Tab组件` - 标签页系统
- `Dock组件` - 停靠面板
- `MAGI面板` - REI系统UI界面

## 下一步分析计划

1. 详细分析REI/MAGI系统的完整功能和实现
2. 探索服务器API的详细实现和能力
3. 分析Tab和Dock系统的实现机制
4. 商业化方案细化，特别是针对REI系统和国际化功能 