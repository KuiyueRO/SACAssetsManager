# SACAssetsManager 服务器模块开发文档

## 项目概述

SACAssetsManager服务器模块是资源管理系统的核心组件，负责提供文件系统访问、缩略图生成、元数据分析、文档处理等核心功能。该模块采用模块化、分层架构设计，确保代码的可维护性和可扩展性。

## 当前主要任务

重构服务器代码结构,优化目前功能的性能

## 架构设计

服务器模块采用以下分层架构：

1. **引导层 (Bootstrap)** - 负责系统初始化和服务启动
2. **API层** - 处理外部请求并路由到相应的处理器
3. **服务层** - 实现核心业务逻辑
4. **数据层** - 管理数据存储和检索

### 目录结构

```
source/server/
├── bootstrap/      - 系统引导和初始化
├── api/            - API定义和处理器
├── services/       - 核心服务实现
├── config/         - 配置管理
├── types/          - 类型定义
├── utils/          - 工具函数
└── middlewares/    - 中间件
```

## 开发规范

### 代码风格

- 使用函数式编程风格，避免不必要的类定义
- 使用命名导出而非默认导出
- 使用有意义的文件名和变量名
- 使用JSDoc进行类型和功能注释

### 文件命名

- 使用有意义的文件名，避免使用`index.js`和`main.js`等无语义名称
- 服务实现文件使用`xxxService.js`格式命名
- API处理器文件使用功能域名称，如`fs.js`、`document.js`等
- 类型定义文件使用与功能域对应的名称

### 错误处理

- 所有异步函数必须使用try/catch处理异常
- 使用统一的错误响应格式
- 记录详细的错误日志，包括错误信息和调用栈

## 模块说明

### 引导模块 (Bootstrap)

引导模块负责系统启动和初始化，包括以下文件：

- `initializer.js` - 系统初始化
- `main.js` - 主入口点
- `preload.js` - 预加载脚本
- `serverStarter.js` - 服务器启动器

### API模块

API模块处理外部请求并路由到相应的处理器，包括：

- `apiService.js` - API服务实现
- `router.js` - 路由实现
- `routes.js` - 路由定义
- `handlers/` - API处理器目录

### 服务模块

服务模块实现核心业务逻辑，每个服务都有自己的目录：

- `fs/` - 文件系统服务
- `thumbnail/` - 缩略图服务
- `color/` - 颜色分析服务
- `document/` - 文档处理服务
- `logger/` - 日志服务
- `db/` - 数据库服务
- `license/` - 许可证服务

## 开发指南

### 添加新API

1. 在`api/handlers/`下创建处理器文件
2. 在处理器文件中定义API函数
3. 在`api/routes.js`中注册路由

### 添加新服务

1. 在`services/`下创建新的服务目录
2. 在服务目录中创建服务实现文件
3. 创建服务相关的类型定义
4. 更新配置文件以支持新服务

## 贡献指南

### Pull Request流程

1. Fork仓库并创建特性分支
2. 实现功能并编写测试
3. 确保所有测试通过
4. 提交Pull Request

### 代码审查标准

- 代码必须符合项目的代码风格
- 所有新功能必须有相应的测试
- 所有新功能必须有相应的文档
- 不应引入新的循环依赖 

## 服务实现进度

服务器模块已完成以下服务的文档设计：

| 服务名称 | 文档状态 | 实现状态 |
|---------|---------|----------|
| 文件系统服务 (fs) | ✅ 已完成 | 🔄 进行中 |
| 日志服务 (logger) | ✅ 已完成 | 🔄 进行中 |
| 缩略图服务 (thumbnail) | ✅ 已完成 | 🔄 进行中 |
| 文档处理服务 (document) | ✅ 已完成 | 🔄 进行中 |
| 颜色分析服务 (color) | ✅ 已完成 | 🔄 进行中 |
| 数据库服务 (database) | ✅ 已完成 | ✅ 已完成 |
| 标签服务 (tag) | ✅ 已完成 | 🔄 进行中 |
| Eagle集成服务 (eagle) | 🔄 进行中 | 🔄 进行中 |

下一步重点工作：

1. 完成文件系统服务实现
2. 完成日志服务实现
3. 实现缩略图服务
4. 实现颜色分析服务
5. 修改入口文件 `index.html`，引用 `bootstrap/main.js`
6. 将处理器与服务模块连接
7. 进行完整功能测试

服务实现的优先级：
1. 核心基础服务（文件系统、日志、数据库）
2. 资源处理服务（缩略图、颜色分析）
3. 组织管理服务（标签、文档处理）
4. 外部集成服务（Eagle） 