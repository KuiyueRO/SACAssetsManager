# 日志数据库模块设计说明

## 功能概述

`logDB.js` 提供了基于 IndexedDB 的高性能日志存储系统，主要特点包括：

- 异步日志存储与检索，不阻塞主线程
- 支持批量操作以提高性能
- 支持按时间、级别、来源等多维度查询
- 安全序列化复杂对象，避免序列化错误

## 设计思路

模块采用了函数式风格，所有功能都通过独立函数实现，避免了类的使用：

1. **核心存储结构**：使用 IndexedDB 作为底层存储，提供高性能的键值对存储
2. **序列化策略**：对日志对象进行安全序列化，确保复杂对象也能被正确存储
3. **功能解耦**：将过滤、查询、序列化等功能拆分为独立函数
4. **异步操作**：所有数据库操作返回 Promise，支持异步调用

## 主要函数分解

- `安全序列化`: 对不同类型的值进行安全序列化，处理特殊情况
- `序列化日志`: 将日志对象转换为可存储形式
- `反序列化日志`: 将存储形式转换回可用的日志对象
- `按级别过滤`/`按时间范围过滤`/`按来源过滤`/`按内容过滤`: 提供各种过滤功能

## 性能考虑

1. 采用批量处理提高写入性能
2. 利用 IndexedDB 的索引加速查询
3. 针对常见查询模式优化了数据结构
4. 日志对象序列化时进行了优化，只保存必要信息

## 使用示例

```javascript
// 初始化数据库
await 初始化数据库();

// 写入日志
await 保存日志([
  {
    级别: 'info',
    内容: '系统启动',
    来源: '系统初始化'
  }
]);

// 查询日志
const 最近日志 = await 加载日志(0, 50);

// 按条件查询
const 错误日志 = await 按条件查询日志({
  级别: 'error',
  开始时间: '2023-01-01T00:00:00Z'
});
```

## 注意事项

1. 使用前必须先调用 `初始化数据库()`
2. 复杂对象会被自动序列化，但函数和循环引用会被特殊处理
3. 定期清理过期日志可提高整体性能
4. 在生产环境建议设置日志大小限制

## 未来优化方向

1. 添加日志压缩和导出功能
2. 支持更复杂的查询条件
3. 添加日志自动清理策略
4. 改进序列化性能 