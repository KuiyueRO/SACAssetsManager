<script type="module">
    import '../utils/hack/hackRequire.js'
    function getExternalBase() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('externalBase');
    }
    function getPort() {
        const urlParams = new URLSearchParams(window.location.search);
        return parseInt(urlParams.get('port'));
    }
    const externalBase = getExternalBase();
    require.setExternalBase(externalBase)

    const express = require('express')
    const app = express()
    // 添加 raw 图片接口
    app.get('/raw', (req, res) => {
        const path = req.query.path;
        const localPath = req.query.localPath;
        // 根据是否有 localPath 参数决定使用哪个路径
        const imagePath = localPath || (externalBase + path);
        // 直接返回图片文件
        res.sendFile(imagePath, (err) => {
            if (err) {
                console.error('发送图片文件失败:', err);
                res.status(404).send('图片未找到');
            }
        });
    });
    const port =getPort() 
    app.listen(port, '127.0.0.1', () => {
        console.log(`服务器运行在 http://127.0.0.1:${port}`);
    })
    app.listen(port, 'localhost', () => {
        console.log(`静态图片服务运行在 http://localhost:${port}`);
    })
</script>