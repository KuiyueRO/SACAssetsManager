<template>
    <div class="fn__flex-column editor-container">
        <div class="fn__flex fn__flex-1">
            <!-- Â∑¶‰æßÂ∑•ÂÖ∑Ê†è -->
            <div class="tools-bar">
                <div class="tool-group">
                    <div class="tool-item" :class="{ active: currentTool === 'components' }"
                        @click="handleToolClick('components')">
                        <i class="icon">üß©</i>
                        <span>ÁªÑ‰ª∂</span>
                    </div>
                    <div class="tool-item" :class="{ active: currentTool === 'pages' }"
                        @click="handleToolClick('pages')">
                        <i class="icon">üìÑ</i>
                        <span>È°µÈù¢</span>
                    </div>
                    <div class="tool-item" :class="{ active: currentTool === 'assets' }"
                        @click="handleToolClick('assets')">
                        <i class="icon">üñºÔ∏è</i>
                        <span>ËµÑÊ∫ê</span>
                    </div>
                </div>
            </div>

            <!-- Â∑¶‰æßÈù¢Êùø -->
            <div class="left-panel" v-if="currentTool === 'components'">
                <div class="section-title">ÁªÑ‰ª∂Â∫ì</div>
                <div class="panel-content">
                    <div class="component-categories">
                        <div v-for="category in componentCategories" :key="category.id" class="category-section">
                            <div class="category-header" @click="toggleCategory(category.id)">
                                <span class="category-icon">{{ category.expanded ? '‚ñº' : '‚ñ∂' }}</span>
                                <span class="category-title">{{ category.name }}</span>
                            </div>
                            <div class="component-grid" v-show="category.expanded">
                                <div v-for="comp in category.components" :key="comp.id" class="component-item"
                                    draggable="true" @dragstart="handleDragStart($event, comp)">
                                    <span class="component-icon">{{ comp.icon }}</span>
                                    <span class="component-name">{{ comp.name }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê∑ªÂä†È°µÈù¢ÁªìÊûÑÈù¢Êùø -->
            <div class="left-panel" v-if="currentTool === 'layers'">
                <div class="section-title">È°µÈù¢ÁªìÊûÑ</div>
                <div class="panel-content">
                    <div class="component-tree">
                        <template v-for="node in getComponentTree" :key="node.id">
                            <div class="component-tree-node" :style="{ paddingLeft: `${node.level * 20}px` }"
                                :class="{ 'selected': selectedComponent?.id === node.id }"
                                @click="selectComponent(node.id)">
                                <span class="component-icon">{{ getComponentIcon(node.type) }}</span>
                                <span class="component-name">{{ node.name }}</span>
                                <div class="node-actions">
                                    <button class="action-btn delete-btn" @click.stop="deleteComponent(node.id)"
                                        title="Âà†Èô§ÁªÑ‰ª∂">
                                        <i class="icon">üóëÔ∏è</i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- ‰∏ªÁºñËæëÂå∫Âüü -->
            <div class="fn__flex fn__flex-1 fn__flex-column editor-main">
                <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
                <div class="editor-toolbar">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" title="Êí§ÈîÄ" @click="undo">
                            <i class="icon">‚Ü©Ô∏è</i>
                        </button>
                        <button class="toolbar-btn" title="ÈáçÂÅö" @click="redo">
                            <i class="icon">‚Ü™Ô∏è</i>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button class="toolbar-btn" :class="{ active: isPreviewMode }" title="È¢ÑËßàÊ®°Âºè"
                            @click="togglePreviewMode">
                            <i class="icon">üëÅÔ∏è</i>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button class="toolbar-btn" title="ÂèëÂ∏É" @click="publish">
                            <i class="icon">üöÄ</i>
                        </button>
                    </div>

                    <!-- ËÆæÂ§áÈÄâÊã©Âô® -->
                    <div class="device-selector">
                        <button class="toolbar-btn" :class="{ active: currentDevice === 'desktop' }"
                            @click="switchDevice('desktop')">
                            <i class="icon">üñ•Ô∏è</i>
                        </button>
                        <button class="toolbar-btn" :class="{ active: currentDevice === 'tablet' }"
                            @click="switchDevice('tablet')">
                            <i class="icon">üì±</i>
                        </button>
                        <button class="toolbar-btn" :class="{ active: currentDevice === 'mobile' }"
                            @click="switchDevice('mobile')">
                            <i class="icon">üì±</i>
                        </button>
                    </div>

                    <!-- Áº©ÊîæÊéßÂà∂ -->
                    <div class="zoom-control">
                        <button class="toolbar-btn" @click="zoomOut">-</button>
                        <span class="zoom-value">{{ (zoom * 100).toFixed(0) }}%</span>
                        <button class="toolbar-btn" @click="zoomIn">+</button>
                    </div>
                </div>

                <!-- ÁîªÂ∏ÉÂÆπÂô® -->
                <div class="editor-workspace" @dragover.prevent @dragenter.prevent @drop.prevent="handleDrop">
                    <div class="editor-content">
                        <iframe :ref="el => previewFrame = el" class="preview-frame" @load="handleIframeLoad">
                        </iframe>
                    </div>
                </div>
            </div>

            <!-- Âè≥‰æßÂ±ûÊÄßÈù¢Êùø -->
            <div class="right-panel">
                <div class="section-title">Â±ûÊÄßËÆæÁΩÆ</div>
                <div class="panel-content">
                    <template v-if="selectedComponent">
                        <!-- Ê†∑ÂºèËÆæÁΩÆ -->
                        <div class="property-section">
                            <h3>Ê†∑Âºè</h3>
                            <div class="property-group">
                                <div class="property-item">
                                    <label>ÂÆΩÂ∫¶</label>
                                    <input type="text" v-model="selectedComponent.style.width">
                                </div>
                                <div class="property-item">
                                    <label>È´òÂ∫¶</label>
                                    <input type="text" v-model="selectedComponent.style.height">
                                </div>
                            </div>
                        </div>

                        <!-- ÁªÑ‰ª∂Â±ûÊÄß -->
                        <div class="property-section">
                            <h3>Â±ûÊÄß</h3>
                            <component :is="getPropertyEditor(selectedComponent.type)"
                                v-model="selectedComponent.props" />
                        </div>

                        <!-- Ë°å‰∏∫ËÆæÁΩÆ -->
                        <div class="property-section" v-if="getComponentBehaviors.length">
                            <h3>‰∫§‰∫íË°å‰∏∫</h3>
                            <div v-for="behaviorType in getComponentBehaviors" :key="behaviorType">
                                <div class="behavior-header">
                                    <span>{{ behaviors[behaviorType].name }}</span>
                                    <div class="switch-toggle">
                                        <input type="checkbox" :id="'behavior-' + behaviorType"
                                            v-model="selectedComponent.behaviors[behaviorType].enabled"
                                            @change="updatePreview" />
                                        <label :for="'behavior-' + behaviorType"></label>
                                    </div>
                                </div>
                                <template v-if="selectedComponent.behaviors[behaviorType].enabled">
                                    <div v-for="(event, eventName) in behaviors[behaviorType].events" :key="eventName"
                                        class="behavior-event">
                                        <div class="event-header">{{ event.name }}</div>
                                        <div class="event-params">
                                            <template v-for="(param, paramName) in event.params" :key="paramName">
                                                <div class="param-item">
                                                    <label>{{ param.name }}</label>
                                                    <input v-if="param.type === 'string'" type="text"
                                                        v-model="selectedComponent.behaviors[behaviorType][eventName][paramName]"
                                                        @change="updatePreview" class="input-control" />
                                                    <input v-else-if="param.type === 'number'" type="number"
                                                        v-model.number="selectedComponent.behaviors[behaviorType][eventName][paramName]"
                                                        @change="updatePreview" class="input-control" />
                                                    <select v-else-if="param.type === 'select'"
                                                        v-model="selectedComponent.behaviors[behaviorType][eventName][paramName]"
                                                        @change="updatePreview" class="select-control">
                                                        <option v-for="option in param.options" :key="option.value"
                                                            :value="option.value">
                                                            {{ option.label }}
                                                        </option>
                                                    </select>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                    <div v-else class="empty-tip">
                        ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÁªÑ‰ª∂ËøõË°åÁºñËæë
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted, nextTick, watch } from 'vue';
import { componentManager, componentTreeManager, componentConfigs } from './componentConfig.js';
import DefaultPropertyEditor from './DefaultPropertyEditor.vue';
import { behaviors } from './componentConfig.js';
import { dragDropManager } from './dragDropManager.js';


// Áä∂ÊÄÅÂÆö‰πâ
const currentTool = ref('components');
const currentDevice = ref('desktop');
const zoom = ref(1);
const selectedComponent = ref(null);
const currentPageId = ref(null);
const pageComponents = ref([]); // Â≠òÂÇ®È°µÈù¢‰∏≠ÁöÑÁªÑ‰ª∂
let componentIdCounter = 0; // Áî®‰∫éÁîüÊàêÁªÑ‰ª∂ÂîØ‰∏ÄID
const isPreviewMode = ref(false);

// Ê∑ªÂä† previewFrame ref
const previewFrame = ref(null);

// Ê®°ÊãüÊï∞ÊçÆ
const componentCategories = ref([
    {
        id: 'basic',
        name: 'Âü∫Á°ÄÁªÑ‰ª∂',
        expanded: true, // ÈªòËÆ§Â±ïÂºÄ
        components: [
            { id: 'text', name: 'ÊñáÊú¨', icon: 'üìù' },
            { id: 'image', name: 'ÂõæÁâá', icon: 'üñºÔ∏è' },
            { id: 'button', name: 'ÊåâÈíÆ', icon: 'üîò' },
            { id: 'divider', name: 'ÂàÜÂâ≤Á∫ø', icon: '‚ö°' }
        ]
    },
    {
        id: 'layout',
        name: 'Â∏ÉÂ±ÄÁªÑ‰ª∂',
        expanded: false,
        components: [
            { id: 'container', name: 'ÂÆπÂô®', icon: 'üì¶' },
            { id: 'grid', name: 'ÁΩëÊ†º', icon: 'üî≤' },
            { id: 'flex', name: 'ÂºπÊÄßÂ∏ÉÂ±Ä', icon: '‚ÜîÔ∏è' }
        ]
    },
    {
        id: 'form',
        name: 'Ë°®ÂçïÁªÑ‰ª∂',
        components: [
            { id: 'input', name: 'ËæìÂÖ•Ê°Ü', icon: '‚úèÔ∏è' },
            { id: 'select', name: '‰∏ãÊãâÈÄâÊã©', icon: '‚ñº' },
            { id: 'checkbox', name: 'Â§çÈÄâÊ°Ü', icon: '‚òëÔ∏è' },
            { id: 'radio', name: 'ÂçïÈÄâÊ°Ü', icon: '‚≠ï' },
            { id: 'form', name: 'Ë°®Âçï', icon: 'üìã' }
        ]
    },
    {
        id: 'content',
        name: 'ÂÜÖÂÆπÂ±ïÁ§∫',
        components: [
            { id: 'list', name: 'ÂàóË°®', icon: 'üìù' },
            { id: 'table', name: 'Ë°®Ê†º', icon: 'üóÉÔ∏è' },
            { id: 'card', name: 'Âç°Áâá', icon: 'üé¥' },
            { id: 'carousel', name: 'ËΩÆÊí≠Âõæ', icon: 'üéûÔ∏è' }
        ]
    },
    {
        id: 'navigation',
        name: 'ÂØºËà™ÁªÑ‰ª∂',
        components: [
            { id: 'menu', name: 'ËèúÂçï', icon: 'üìë' },
            { id: 'tabs', name: 'Ê†áÁ≠æÈ°µ', icon: 'üìë' },
            { id: 'breadcrumb', name: 'Èù¢ÂåÖÂ±ë', icon: 'üîó' }
        ]
    }
]);

const pages = ref([
    { id: 'page1', name: 'È¶ñÈ°µ' },
    { id: 'page2', name: 'ÂÖ≥‰∫éÊàë‰ª¨' }
]);

// ËÆ°ÁÆóÂ±ûÊÄß
const getPanelTitle = computed(() => {
    const titles = {
        components: 'ÁªÑ‰ª∂Â∫ì',
        layers: 'ÂõæÂ±Ç',
        pages: 'È°µÈù¢',
        assets: 'ËµÑÊ∫êÂ∫ì'
    };
    return titles[currentTool.value] || '';
});

// ÊñπÊ≥ïÂÆö‰πâ
const handleToolClick = (tool) => {
    currentTool.value = tool;
};

const switchDevice = (device) => {
    currentDevice.value = device;
    updatePreviewDevice(device);
};

const zoomIn = () => {
    zoom.value = Math.min(zoom.value + 0.1, 2);
    updatePreviewZoom(zoom.value);
};

const zoomOut = () => {
    zoom.value = Math.max(zoom.value - 0.1, 0.2);
    updatePreviewZoom(zoom.value);
};

// ÂàùÂßãÂåñÊãñÊãΩÁÆ°ÁêÜÂô®
onMounted(() => {
    dragDropManager.init(
        updatePreview,
        (component) => selectedComponent.value = component
    );
    console.log('Component mounted');

    // ËÆæÁΩÆÈ¢ÑËßàÈ°µÈù¢ÁöÑURL
    nextTick(() => {
        if (previewFrame.value) {
            const previewUrl = new URL('/plugins/SACAssetsManager/source/UI/pannels/pageEditor/previewer.html', window.location.href);
            previewFrame.value.src = previewUrl.href;
            console.log('Preview URL set:', previewUrl.href);
        } else {
            console.error('Preview frame not available in onMounted');
        }
    });


    // ‰øÆÊîπÊãñÊãΩÁõ∏ÂÖ≥ÁöÑ‰∫ã‰ª∂ÁõëÂê¨
    const editorWorkspace = document.querySelector('.editor-workspace');
    if (editorWorkspace) {
        editorWorkspace.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            e.dataTransfer.dropEffect = 'copy';
        });
    }

    // Ê∑ªÂä† iframe Ê∂àÊÅØÁõëÂê¨
    window.addEventListener('message', handleMessage);
    console.log('Message listener added');
});

// Ê∑ªÂä†ÁªÑ‰ª∂Âç∏ËΩΩÊó∂ÁöÑÊ∏ÖÁêÜ
onUnmounted(() => {
    const editorWorkspace = document.querySelector('.editor-workspace');
    if (editorWorkspace) {
        editorWorkspace.removeEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
    }
    window.removeEventListener('message', handleMessage);
});

const updatePreviewDevice = (device) => {
    if (previewFrame.value?.contentWindow) {
        previewFrame.value.contentWindow.postMessage({
            type: 'updateDevice',
            device: device
        }, '*');
    }
};

const updatePreviewZoom = (newZoom) => {
    if (previewFrame.value?.contentWindow) {
        previewFrame.value.contentWindow.postMessage({
            type: 'updateZoom',
            zoom: newZoom
        }, '*');
    }
};

// Ê∑ªÂä†ÁªÑ‰ª∂hoverÂ§ÑÁêÜÊñπÊ≥ï
const handleComponentHover = (componentId) => {
    if (previewFrame.value?.contentWindow) {
        previewFrame.value.contentWindow.postMessage({
            type: 'highlightComponent',
            componentId: componentId
        }, '*');
    }
};

// Ëé∑ÂèñÁªÑ‰ª∂ÊîØÊåÅÁöÑË°å‰∏∫
const getComponentBehaviors = computed(() => {
    if (!selectedComponent.value) return [];
    const config = componentConfigs[selectedComponent.value.type];
    return config?.behaviors || [];
});

// ÂàùÂßãÂåñÁªÑ‰ª∂Ë°å‰∏∫
const initComponentBehaviors = (component) => {
    component.behaviors = componentManager.initComponentBehaviors(component.type);
};

// ÂàáÊç¢È¢ÑËßàÊ®°Âºè
const togglePreviewMode = () => {
    isPreviewMode.value = !isPreviewMode.value;
    // ÈÄöÁü•È¢ÑËßàÊ°ÜÊû∂Êõ¥Êñ∞Ê®°Âºè
    if (previewFrame.value?.contentWindow) {
        previewFrame.value.contentWindow.postMessage({
            type: 'updateMode',
            isPreviewMode: isPreviewMode.value
        }, '*');
    }
};

// Ê∑ªÂä†È°µÈù¢ÁªìÊûÑÂ±ïÁ§∫Áõ∏ÂÖ≥‰ª£Á†Å
const getComponentTree = computed(() =>
    componentTreeManager.buildComponentTree(pageComponents.value)
);

// Ëé∑ÂèñÁªÑ‰ª∂ÊòæÁ§∫ÂêçÁß∞
const getComponentName = (component) => componentManager.getComponentName(component);
const getComponentIcon = (type) => componentManager.getComponentIcon(type);

// Ê∑ªÂä†ÁªÑ‰ª∂Ê†ëÊ∏≤ÊüìÊ®°Êùø
const renderComponentTree = (tree) => {
    return tree.map(node => `
        <div class="component-tree-node" 
             style="padding-left: ${node.level * 20}px"
             :class="{ 'selected': selectedComponent?.id === node.id }"
             @click="selectComponent(node.id)">
            <span class="component-icon">${getComponentIcon(node.type)}</span>
            <span class="component-name">${node.name}</span>
            ${node.children.length ? renderComponentTree(node.children) : ''}
        </div>
    `).join('');
};

// ÂàáÊç¢ÂàÜÁ±ªÂ±ïÂºÄ/ÊäòÂè†
const toggleCategory = (categoryId) => {
    const category = componentCategories.value.find(c => c.id === categoryId);
    if (category) {
        category.expanded = !category.expanded;
    }
};

// ‰øÆÊîπ handleDragStart
const handleDragStart = (event, component) => {
    dragDropManager.handleDragStart(event, component);
};

// ‰øÆÊîπ handleMessage ÂáΩÊï∞ÔºåÊ∑ªÂä†Êó•ÂøóËæìÂá∫‰ª•‰æøË∞ÉËØï
const handleMessage = (event) => {
    console.log('Received message:', event.data); // Ë∞ÉËØïÊó•Âøó

    if (event.data.type === 'exportPage') {
        console.log('Export content length:', event.data.content?.length); // Ê£ÄÊü•ÂÜÖÂÆπÊòØÂê¶Â≠òÂú®
        handleExport(event.data.content);
        return; // Á°Æ‰øùÂØºÂá∫Ê∂àÊÅØË¢´‰ºòÂÖàÂ§ÑÁêÜ
    }

    switch (event.data.type) {
        case 'iframe-dragover':
            dragDropManager.handleIframeDragOver(event.data);
            break;

        case 'iframe-drop':
            dragDropManager.handleIframeDrop(event.data, pageComponents.value);
            break;

        case 'componentSelected':
            const selectedId = event.data.componentId;
            selectedComponent.value = pageComponents.value.find(
                comp => comp.id === selectedId
            );
            break;

        case 'componentHover':
            handleComponentHover(event.data.componentId);
            break;
        case 'menuAction':
            handleMenuAction(event.data);
            break;

    }
};
const handleMenuAction = (data) => {
    const { action, componentId } = data;
    
    switch(action) {
        case 'delete':
            // ÈÄíÂΩíÂà†Èô§ÁªÑ‰ª∂ÂèäÂÖ∂Â≠êÁªÑ‰ª∂
            const deleteComponent = (components) => {
                return components.filter(comp => {
                    if (comp.id === componentId) {
                        return false;
                    }
                    if (comp.children) {
                        comp.children = deleteComponent(comp.children);
                    }
                    return true;
                });
            };
            
            pageComponents.value = deleteComponent(pageComponents.value);
            
            // Â¶ÇÊûúË¢´Âà†Èô§ÁöÑÁªÑ‰ª∂ÊòØÂΩìÂâçÈÄâ‰∏≠ÁöÑÁªÑ‰ª∂ÔºåÊ∏ÖÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
            if (selectedComponent.value?.id === componentId) {
                selectedComponent.value = null;
            }
            break;
            
        // ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÂÖ∂‰ªñËèúÂçïÊìç‰ΩúÁöÑÂ§ÑÁêÜ
        case 'edit':
            // Â§ÑÁêÜÁºñËæëÊìç‰Ωú
            break;
            
        case 'add':
            // Â§ÑÁêÜÊ∑ªÂä†Êìç‰Ωú
            break;
    }
};
// Ê∑ªÂä†Â±ûÊÄßÁºñËæëÂô®Êò†Â∞Ñ
const getPropertyEditor = (componentType) => {
    const editors = {
        text: 'TextPropertyEditor',
        button: 'ButtonPropertyEditor',
        image: 'ImagePropertyEditor'
    };
    return editors[componentType] || 'DefaultPropertyEditor';
};

// Ê≥®ÂÜåÁªÑ‰ª∂
const components = {
    DefaultPropertyEditor
};

// Ê∑ªÂä† updatePreview ÊñπÊ≥ï
const updatePreview = () => {
    if (previewFrame.value?.contentWindow) {
        // ÂàõÂª∫‰∏Ä‰∏™ÂèØÂ∫èÂàóÂåñÁöÑÁªÑ‰ª∂Êï∞ÊçÆÂâØÊú¨
        const serializableComponents = JSON.parse(JSON.stringify(pageComponents.value));

        previewFrame.value.contentWindow.postMessage({
            type: 'updateComponents',
            components: serializableComponents,
            selectedId: selectedComponent.value?.id
        }, '*');
    }
};

// ÁõëÂê¨ÁªÑ‰ª∂ÂèòÂåñÂπ∂Êõ¥Êñ∞È¢ÑËßà
watch(pageComponents, () => {
    updatePreview();
}, { deep: true });

// ÁõëÂê¨ÈÄâ‰∏≠ÁªÑ‰ª∂ÂèòÂåñÂπ∂Êõ¥Êñ∞È¢ÑËßà
watch(selectedComponent, () => {
    updatePreview();
});

// ‰øÆÊîπÂØºÂá∫Â§ÑÁêÜÂáΩÊï∞
const handleExport = (htmlContent) => {
    console.log('Starting export process...', htmlContent.length);

    if (!htmlContent) {
        console.error('No content to export');
        window.$message?.error('ÂØºÂá∫Â§±Ë¥•ÔºöÊ≤°ÊúâÂèØÂØºÂá∫ÁöÑÂÜÖÂÆπ');
        return;
    }

    try {
        // ÂàõÂª∫ Blob ÂØπË±°
        const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
        console.log('Blob created:', blob.size);

        // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
        const url = URL.createObjectURL(blob);
        const fileName = `page-${new Date().getTime()}.html`;

        // ÂàõÂª∫Âπ∂ÈÖçÁΩÆ‰∏ãËΩΩÈìæÊé•
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;

        // ÂàõÂª∫Âπ∂Ëß¶ÂèëÁÇπÂáª‰∫ã‰ª∂
        const clickEvent = new MouseEvent('click', {
            view: window,
            bubbles: true,
            cancelable: false
        });

        console.log('Triggering download with dispatchEvent...');
        link.dispatchEvent(clickEvent);

        // Ê∏ÖÁêÜ
        setTimeout(() => {
            URL.revokeObjectURL(url);
            console.log('Cleanup completed');
        }, 100);

        window.$message?.success('È°µÈù¢ÂØºÂá∫ÊàêÂäüÔºÅ');
    } catch (error) {
        console.error('Export failed:', error);
        window.$message?.error(`ÂØºÂá∫Â§±Ë¥•Ôºö${error.message}`);
    }
};

</script>

<style scoped>
/* Âü∫Á°ÄÂ∏ÉÂ±ÄÊ†∑Âºè */
.editor-container {
    height: 100%;
    width: 100%;
}

/* ÂêàÂπ∂ÊâÄÊúâÁªÑ‰ª∂Áõ∏ÂÖ≥ÁöÑÂü∫Á°ÄÊ†∑Âºè */
.component-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
    background: var(--cc-theme-surface);
    border: 1px solid var(--cc-border-color);
    border-radius: var(--cc-border-radius);
    cursor: move;
    transition: all 0.2s;
}

.component-item:hover {
    background: var(--cc-theme-surface-hover);
    border-color: var(--cc-theme-primary);
    transform: translateY(-2px);
}

.component-icon {
    font-size: 24px;
    margin-bottom: 8px;
}

.component-name {
    font-size: 12px;
    color: var(--cc-text-color);
}

/* ÂêàÂπ∂ÁΩëÊ†ºÁõ∏ÂÖ≥Ê†∑Âºè */
.component-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 12px;
    background: #fff;
    transition: all 0.3s ease;
    max-height: 1000px;
    opacity: 1;
}

.component-grid[v-show="false"] {
    max-height: 0;
    opacity: 0;
    padding: 0;
    margin: 0;
}

/* Âà†Èô§ÈáçÂ§çÁöÑÈù¢ÊùøÊ†∑Âºè,‰øùÁïô‰∏Ä‰∏™Áªü‰∏ÄÁöÑÁâàÊú¨ */
.panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

/* Âà†Èô§ÈáçÂ§çÁöÑÂ∑•ÂÖ∑Ê†èÊåâÈíÆÊ†∑Âºè */
.toolbar-btn {
    height: 32px;
    min-width: 32px;
    padding: 0 8px;
    border: 1px solid var(--cc-border-color);
    border-radius: 4px;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: var(--cc-theme-text-secondary);
}

/* Â∑¶‰æßÂ∑•ÂÖ∑Ê†èÊ†∑Âºè‰ºòÂåñ */
.tools-bar {
    width: 80px;
    /* Ë∞ÉÊï¥‰∏∫Êõ¥ÂÆΩÁöÑÂ∑•ÂÖ∑Ê†è */
    min-width: 80px;
    background: var(--cc-theme-surface);
    border-right: 1px solid var(--cc-border-color);
    padding: 12px 0;
}

.tool-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.tool-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    cursor: pointer;
    transition: background-color 0.2s;
    position: relative;
    /* ‰∏∫ÊøÄÊ¥ªÁä∂ÊÄÅÁöÑËæπÊ°ÜÂÅöÂáÜÂ§á */
}

.tool-item:hover {
    background-color: var(--cc-theme-surface-hover);
}

.tool-item.active {
    background-color: var(--cc-theme-surface-hover);
}

.tool-item.active::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: var(--cc-theme-primary);
}

.tool-item .icon {
    font-size: 20px;
    margin-bottom: 4px;
}

.tool-item span {
    font-size: 12px;
}

/* Â∑¶‰æßÈù¢ÊùøÊ†∑Âºè */
.left-panel {
    width: 280px;
    min-width: 280px;
    background: var(--cc-theme-surface);
    border-right: 1px solid var(--cc-border-color);
    display: flex;
    flex-direction: column;
}

.section-title {
    padding: 12px 16px;
    font-size: 14px;
    font-weight: 500;
    border-bottom: 1px solid var(--cc-border-color);
}

.panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
}

/* ÁªÑ‰ª∂Èù¢ÊùøÊ†∑Âºè */
.components-panel {
    padding: 16px;
}

.component-category {
    margin-bottom: 24px;
}

.category-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 12px;
    color: var(--cc-theme-text-secondary, #666);
}

.component-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 4px;
}

.component-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
    background: var(--cc-theme-surface-light);
    border: 1px solid var(--cc-border-color);
    border-radius: var(--cc-border-radius);
    cursor: move;
    transition: all 0.2s;
}

.component-item:hover {
    background: var(--cc-theme-surface-hover);
    transform: translateY(-2px);
}

/* ÁîªÂ∏ÉÂå∫ÂüüÊ†∑Âºè */
.editor-main {
    position: relative;
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    min-height: 0;
    background: #f0f0f0;
}

.editor-toolbar {
    height: 48px;
    padding: 0 16px;
    background: var(--cc-theme-surface);
    border-bottom: 1px solid var(--cc-border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
}

.toolbar-group {
    display: flex;
    align-items: center;
    gap: 4px;
}

.toolbar-separator {
    width: 1px;
    height: 24px;
    background: var(--cc-border-color);
    margin: 0 8px;
}

.toolbar-btn {
    height: 32px;
    min-width: 32px;
    padding: 0 8px;
    border: 1px solid var(--cc-border-color);
    border-radius: 4px;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: var(--cc-theme-text-secondary);
}

.toolbar-btn:hover {
    background: var(--cc-theme-surface-hover);
    color: var(--cc-theme-primary);
    border-color: var(--cc-theme-primary);
}

.toolbar-btn.active {
    background: var(--cc-theme-primary-light);
    border-color: var(--cc-theme-primary);
    color: var(--cc-theme-primary);
}

/* ÁîªÂ∏ÉÂÆπÂô®Ê†∑Âºè */
.editor-workspace {
    position: relative;
    flex: 1;
    width: 100%;
    min-height: 0;
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    background-image: linear-gradient(45deg, #80808010 25%, transparent 25%),
        linear-gradient(-45deg, #80808010 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #80808010 75%),
        linear-gradient(-45deg, transparent 75%, #80808010 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    cursor: default;
}

.editor-content {
    position: relative;
    background: white;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    margin: auto;
    width: 100%;
    height: 100%;
}

/* Âè≥‰æßÂ±ûÊÄßÈù¢ÊùøÊ†∑Âºè */
.right-panel {
    width: 300px;
    min-width: 300px;
    background: var(--cc-theme-surface);
    border-left: 1px solid var(--cc-border-color);
    display: flex;
    flex-direction: column;
}

.panel-content {
    padding: 16px;
    overflow-y: auto;
}

.property-section {
    margin-bottom: 24px;
    background: var(--cc-theme-surface);
    border-radius: var(--cc-border-radius);
    padding: 16px;
}

.property-section h3 {
    margin: 0 0 16px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--cc-theme-text, #333);
}

.property-item {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.property-item label {
    width: 80px;
    font-size: 13px;
    color: var(--cc-theme-text-secondary, #666);
}

.property-item input {
    flex: 1;
    padding: var(--cc-space-xs);
    border: 1px solid var(--cc-border-color);
    border-radius: var(--cc-border-radius);
    background: var(--cc-theme-surface-light);
}

/* È¢ÑËßàÊ°ÜÊû∂Ê†∑Âºè */
.preview-frame {
    display: block;
    width: 100%;
    height: 100%;
    border: none;
    background: white;
    border-radius: 4px;
}

/* Á©∫Áä∂ÊÄÅÊèêÁ§∫ */
.empty-tip {
    text-align: center;
    padding: 40px 20px;
    color: var(--cc-theme-text-secondary, #666);
    font-size: 14px;
}

/* ÊåâÈíÆÂíåÊìç‰ΩúÊ†∑Âºè */
.btn {
    padding: 8px 16px;
    border: 1px solid var(--cc-border-color);
    border-radius: var(--cc-border-radius);
    background: var(--cc-theme-surface-light);
    cursor: pointer;
    transition: all 0.2s;
}

.btn:hover {
    background: var(--cc-theme-surface-hover);
}

.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: var(--cc-border-radius);
}

.action-btn:hover {
    background: var(--cc-theme-surface-hover);
}

/* Áº©ÊîæÊéßÂà∂Ê†∑Âºè‰ºòÂåñ */
.zoom-control {
    display: flex;
    align-items: center;
    gap: 4px;
    background: var(--cc-theme-surface-light);
    padding: 2px;
    border-radius: 4px;
    border: 1px solid var(--cc-border-color);
}

.zoom-value {
    padding: 0 8px;
    font-size: 13px;
    color: var(--cc-theme-text-secondary);
    min-width: 60px;
    text-align: center;
}

/* ËÆæÂ§áÈÄâÊã©Âô®Ê†∑Âºè */
.device-selector {
    display: flex;
    align-items: center;
    gap: 4px;
    background: var(--cc-theme-surface-light);
    padding: 2px;
    border-radius: 4px;
    border: 1px solid var(--cc-border-color);
}

.device-selector .toolbar-btn {
    border: none;
    height: 28px;
    min-width: 28px;
    border-radius: 2px;
}

.device-selector .toolbar-btn:hover {
    background: var(--cc-theme-surface-hover);
}

.device-selector .toolbar-btn.active {
    background: var(--cc-theme-primary-light);
}

.canvas-container {
    background: #f5f5f5;
    min-height: 100%;
    padding: 20px;
}

.layout-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 1200px;
    margin: 0 auto;
    min-height: 100%;
}

.editor-component {
    transition: all 0.2s ease;
    position: relative;
}

.editor-component:hover {
    outline: 2px solid var(--cc-theme-primary, #1890ff);
}

/* ÊñáÊú¨ÁªÑ‰ª∂ÁâπÂÆöÊ†∑Âºè */
.editor-component.text {
    background: #fff;
    border-radius: 4px;
    cursor: pointer;
}

/* ÂìçÂ∫îÂ∏ÉÂ±Ä */
@media (max-width: 768px) {
    .layout-grid {
        max-width: 100%;
        padding: 12px;
    }
}

/* Ê∑ªÂä†ÁªÑ‰ª∂È´ò‰∫ÆÊ†∑Âºè */
.editor-component.highlight {
    outline: 2px solid #1890ff;
    box-shadow: 0 0 8px rgba(24, 144, 255, 0.2);
}

/* Ê∑ªÂä†ËÆæÂ§áÂìçÂ∫îÂºèÊ†∑Âºè */
#app {
    transition: max-width 0.3s ease;
    margin: 0 auto;
    width: 100%;
}

/* Ê∑ªÂä†Áº©ÊîæËøáÊ∏°ÊïàÊûú */
body {
    transition: zoom 0.3s ease;
}

/* Ê∑ªÂä†Ë°å‰∏∫ÁºñËæëÂô®Ê†∑Âºè */
.behavior-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.behavior-event {
    margin-bottom: 16px;
    padding: 12px;
    background: var(--cc-theme-surface-light);
    border-radius: 4px;
}

.event-header {
    font-weight: 500;
    margin-bottom: 8px;
}

.event-params {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.param-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.param-item label {
    width: 80px;
    flex-shrink: 0;
}

/* Ê∑ªÂä†Ëá™ÂÆö‰πâÂºÄÂÖ≥Ê†∑Âºè */
.switch-toggle {
    position: relative;
    width: 40px;
    height: 20px;
}

.switch-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.switch-toggle label {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 20px;
}

.switch-toggle label:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

.switch-toggle input:checked+label {
    background-color: var(--cc-theme-primary);
}

.switch-toggle input:checked+label:before {
    transform: translateX(20px);
}

/* Ê∑ªÂä†Ëá™ÂÆö‰πâËæìÂÖ•Ê°ÜÂíåÈÄâÊã©Ê°ÜÊ†∑Âºè */
.input-control,
.select-control {
    width: 100%;
    padding: 6px 12px;
    border: 1px solid var(--cc-border-color);
    border-radius: var(--cc-border-radius);
    background: var(--cc-theme-surface-light);
    font-size: 14px;
}

.input-control:focus,
.select-control:focus {
    outline: none;
    border-color: var(--cc-theme-primary);
}

.select-control {
    appearance: none;
    background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23666' viewBox='0 0 12 12'%3E%3Cpath d='M3 5l3 3 3-3'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 24px;
}

/* Ê∑ªÂä†ÁªÑ‰ª∂Ê†ëÊ†∑Âºè */
.component-tree {
    padding: 12px;
}

.component-tree-node {
    display: flex;
    align-items: center;
    padding: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.component-tree-node:hover {
    background: var(--cc-theme-surface-hover);
}

.component-tree-node.selected {
    background: var(--cc-theme-surface-selected);
}

.component-tree-node .component-icon {
    font-size: 16px;
    margin-right: 8px;
}

.component-tree-node .component-name {
    font-size: 14px;
}

.component-categories {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.category-section {
    border: 1px solid var(--cc-border-color);
    border-radius: 4px;
    overflow: hidden;
}

.category-header {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    background: var(--cc-theme-surface);
    cursor: pointer;
    user-select: none;
}

.category-header:hover {
    background: var(--cc-theme-surface-hover);
}

.category-icon {
    margin-right: 8px;
    font-size: 12px;
    transition: transform 0.2s;
}

.category-title {
    font-size: 14px;
    font-weight: 500;
}
</style>