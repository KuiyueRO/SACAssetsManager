# 这个区段由开发者编写,未经允许禁止AI修改
批量全景导出组件是用于批量将全景图生成为视频的功能模块

## 组件结构与关注点分离

本组件应用了严格的关注点分离原则，将功能拆分为多个模块：

1. 主组件 BatchPanoramaExporter.vue - 组织和协调其他组件
2. 子组件
   - FileSelector.vue - 处理文件选择相关功能
   - SettingProfile.vue - 单个导出设置配置
   - SettingsManager.vue - 管理多个导出设置配置
   - TaskList.vue - 处理任务列表显示和管理
   - OutputSettings.vue - 输出设置管理
3. 工具函数
   - common.js - 通用工具函数
   - fileUtils.js - 文件处理相关函数
   - watermarkUtils.js - 水印处理相关函数
   - previewUtils.js - 预览生成相关函数
   - exportUtils.js - 导出处理相关函数

## 功能说明

批量全景导出组件允许用户：
1. 选择多个全景图文件
2. 创建多个导出配置（不同分辨率、帧率等）
3. 为每个全景图添加文字或图片水印
4. 批量导出为视频，支持不同的导出目录设置

## 开发规范

代码应遵循以下规范：
1. 使用函数式编程风格
2. 避免组件嵌套过深
3. 使用命名导出而非默认导出
4. 组件和函数命名遵循语义化原则
5. 函数应当职责单一
6. UI与业务逻辑分离

## 后续优化方向

1. 支持更多视频格式和编码选项
2. 增加预设模板功能，允许保存和加载用户配置
3. 优化渲染性能和内存使用
4. 增加批量重命名功能

# 批量全景视频导出器 - 音频处理优化

## 音频处理流程优化

原有的音频处理流程存在以下问题：
1. 视频生成后需要二次合成音频，效率低下且容易出错
2. 使用了多种不同的音频合成方法导致代码复杂
3. 有重复的音频处理逻辑

当前优化方案：
1. 直接利用VideoEncoderManager的音频处理能力进行一次性编码
2. 移除了二次合成的代码，简化流程
3. 保留了音频适配模式的处理逻辑，确保视频时长可以根据音频时长调整

## 实现细节

- `processExportTask`函数现在直接将音频配置传递给`PanoramaVideoGenerator`
- `PanoramaVideoGenerator.startRecording`方法接收音频配置并传递给`VideoEncoderManager`
- 移除了不再需要的二次合成函数导入和调用
- 进度条的计算和阶段提示进行了相应调整

## 性能和兼容性考量

此优化基于浏览器的WebCodecs API，通过一次性处理音视频数据：
1. 避免了临时视频文件的生成和解码，降低了内存占用
2. 减少了视频处理的阶段，提高了整体效率
3. 由于使用同一套编码器，确保了音视频同步更精确

## 后续优化方向

1. 可以考虑优化音频处理逻辑，在适配音频时长时提供更灵活的选项
2. 添加更多音频处理功能，如淡入淡出效果
3. 进一步优化内存使用，特别是在处理大分辨率视频时