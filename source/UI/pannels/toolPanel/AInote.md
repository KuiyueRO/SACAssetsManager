# 这个区段由开发者编写,未经允许禁止AI修改

注意：本项目的重要原则和规范已统一记录在根目录下的 `diary/principles.md` 中，请遵循该文档中的规范进行开发。

这个文件所在的工具面板是这个插件项目极其重要的一个组件,它必须被逐渐增强到能够作为插件绝大多数功能的界面入口
---

# AI 笔记 - toolPanel

## 历史记录与重要变更

*   **2025-05-02 05:35 (织):** 
    *   规划功能：设计批处理菜单与节点系统集成方案
        *   创建了详细的集成方案，记录在 `diary/batch_menu_integration.md` 中
        *   设计了交互式节点JSDoc扩展标签系统：
            *   `@nodeInteraction confirm|input` - 用于添加确认/输入对话框
            *   `@nodeProgress` - 用于显示任务进度对话框
            *   `@nodeVisibility flow|panel|both` - 控制节点在何处显示
        *   设计了节点可见性过滤机制，基于以下判断标准：
            *   独立使用价值 - 高时选择panel
            *   操作复杂度 - 高时选择flow
            *   使用频率 - 高时选择panel
            *   UI交互需求 - 复杂时选择panel
        *   设计了批处理函数包装器，为节点添加交互能力
        *   确定了优先节点化的批处理功能：
            *   文件扫描类：扫描重复文件、扫描空文件夹、整理纯色图片
            *   文件处理类：文件去重、展平并按扩展名分组、图片去重
            *   文件组织类：复制文档树结构、批量打包文件
        *   下一步实现计划：
            *   扩展JSDoc解析器添加交互标签支持
            *   实现批处理函数包装器
            *   优先对文件扫描类功能进行节点化
*   **2025-05-02 (织):** 
    *   新增功能：支持Petri网编辑器的节点解析方式，从JSDoc解析工具节点
        *   创建了 `NodeParser.js` 实现从JSDoc解析工具节点的功能
            *   支持通过自定义标签 `@nodeCategory`、`@nodeType`、`@nodeName`、`@nodeIcon` 等定义节点属性
            *   从函数的JSDoc注释中解析输入/输出类型、默认值和示例
        *   创建了 `NodeLoader.js` 实现节点的加载和管理
            *   支持从JS文件或模块中加载节点
            *   将节点按分类组织并提供访问接口
        *   添加了黄色刷子工具作为新解析方式的示例
            *   创建了 `yellowColorBrush.js` 和对应的 `YellowColorBrushNode.vue` 组件
            *   更新了 `CustomNodeRenderer.vue` 支持新增节点的渲染
        *   修改了 `index.vue` 整合节点加载功能
            *   自动从JSDoc注释解析节点定义并合并到现有节点分类中
        *   系统现在同时支持手动定义节点和自动解析JSDoc的混合模式
*   **2025-05-01 (织):** 
    *   新增功能：完全实现与Petri网编辑器一致的节点解析方式
        *   重构 `NodeParser.js`，实现从JSDoc直接动态生成Vue组件的功能
            *   支持根据不同的节点类型（工具/函数/组件）生成对应的Vue组件模板
            *   根据输入参数类型自动生成表单控件
            *   自动处理组件样式和交互逻辑
        *   创建 `DynamicNodeRenderer.vue` 组件，替代旧的静态渲染方式
            *   支持实时动态加载和渲染从JSDoc生成的组件
            *   保留对静态组件的向后兼容
            *   提供友好的加载状态和错误处理
        *   添加数学工具函数作为函数式节点示例
            *   创建了 `mathUtil.js` 包含各种数学函数
            *   通过JSDoc注释自动生成UI界面
        *   修改 `index.vue` 以整合新功能
            *   自动为解析的节点添加源文件路径用于动态加载
            *   支持批量从多个模块加载节点
        *   系统现在支持：
            *   仅编写JS函数和JSDoc注释，自动生成节点和UI
            *   同一个组件可在Petri网编辑器和工具面板中使用
            *   无需为每个功能单独创建Vue组件文件
    *   新增功能：添加红色刷子工具
        *   实现了一个红色刷子节点，可以将思源块的背景设置为红色
        *   创建了 `colorBrush.js` 工具，提供刷子模式处理逻辑
        *   添加了 `CustomNodeRenderer.vue` 组件，用于动态渲染自定义节点
        *   修改了 `NodeCategoryList.vue`，支持区分普通节点和工具节点的渲染
        *   红色刷子工具特性：
            *   点击工具进入刷子模式，鼠标变为自定义光标
            *   悬停在思源块上时会显示半透明红色背景预览
            *   点击块时会设置块的背景为红色，并保存样式到块属性
            *   按ESC键或右键点击可退出刷子模式
*   **2023-08-06 (织):** 
    *   修复并增强：完善节点详情弹窗和收藏功能的整合
        *   修复了节点卡片点击应该打开详情弹窗而不是直接使用节点的问题
        *   增强了 `NodeDetailDialog.vue` 组件，添加收藏功能：
            *   在弹窗标题栏添加收藏/取消收藏按钮
            *   通过 `isFavorite` 属性动态显示收藏状态
            *   将收藏状态变更通过 `toggle-favorite` 事件传递给父组件
        *   更新了 `FavoriteNodes.vue` 组件：
            *   点击收藏节点项也能打开详情弹窗
            *   保持与节点卡片相同的交互体验
        *   更新了 `index.vue`：
            *   为节点详情弹窗传递当前节点的收藏状态
            *   处理来自详情弹窗的收藏事件
        *   优化整体用户体验：
            *   用户可以从多个入口（卡片、收藏项）查看节点详情
            *   在详情弹窗中可以直接收藏/取消收藏节点
            *   保持UI和交互的一致性，提高用户体验
*   **2023-08-06 (织):** 
    *   修复：优化节点详情弹窗的展示逻辑
        *   修改 `NodeCard.vue` 组件中的点击处理逻辑，将卡片点击行为从直接使用节点改为显示详情
        *   卡片点击时现在会触发 `handleInfoClick` 而不是 `handleUseClick`
        *   这样用户可以点击卡片查看完整的节点详情，再决定是否使用该节点
        *   详情弹窗提供了更完善的节点信息，包括输入/输出端口、默认值和示例代码
*   **2023-08-05 (织):** 
    *   增强功能：添加节点收藏功能
        *   新增 `FavoriteNodes.vue` 组件，显示和管理用户收藏的节点
        *   更新 `NodeCard.vue`，添加收藏按钮，支持切换节点收藏状态
        *   更新 `NodeCategoryList.vue`，支持显示节点收藏状态和处理收藏事件
        *   更新主组件 `index.vue`，整合收藏功能，包括：
            *   在工具栏和节点库之间添加收藏节点区域
            *   实现节点收藏和取消收藏功能
            *   使用本地存储记住用户收藏的节点
        *   改进交互体验：
            *   使用金色星标表示已收藏的节点
            *   添加收藏状态切换动画
            *   优化空状态的提示
*   **2023-08-04 (织):** 
    *   组件完整性分析与改进建议：
        *   当前实现已经具备完整的工具面板功能，包括最近工具栏和节点库
        *   工具面板使用响应式设计，支持三种显示模式：网格、列表和纯图标
        *   节点库实现了搜索、分类筛选和详情查看功能
        *   可能的改进方向：
            *   优化节点拖拽体验，增加拖拽预览和放置指示
            *   添加节点收藏功能，允许用户收藏常用节点
            *   支持节点库自定义分类和排序
            *   增强节点卡片的交互反馈和过渡动画
            *   考虑添加键盘快捷键支持，提高操作效率
            *   进一步优化移动设备上的触摸操作体验
*   **2023-07-12 (织):** 
    *   重大优化：改进界面交互和视觉体验
        *   将工具栏升级为最近工具功能，自动记录和显示用户最常用的工具
        *   参考 modelList.vue 和 index.vue 重新设计节点库界面，采用卡片样式显示节点
        *   创建多个复用性强的公共组件：
            *   `NodeCard.vue` - 美观的节点卡片组件，显示节点详情和元数据
            *   `RecentTools.vue` - 最近工具组件，支持本地存储和自适应布局
            *   `NodeCategoryList.vue` - 节点分类列表组件，支持分类筛选和搜索
        *   优化布局和间距，为组件添加细致的过渡动画
        *   改进节点分类显示方式，使用标签筛选代替嵌套列表
        *   统一设计语言，确保所有组件风格一致
*   **2023-07-11 (织):** 
    *   改进界面布局，直接将节点库内容集成到面板中：
        *   移除了原先需要点击按钮才能展开的节点库弹出面板
        *   将节点库直接显示在工具栏下方，更便于直接访问和使用
        *   添加了分隔线和节点库标题，使界面结构更清晰
        *   优化了面板的滚动行为，支持在单一视图中查看所有内容
        *   保留了原有的搜索和分类功能，使节点库保持高效可用
*   **2023-07-10 (织):** 
    *   重构组件结构，实现更好的关注点分离：
        *   将原来的大型 `toolPanel.vue` 组件拆分为多个子组件：
            *   `ToolBar.vue` - 负责显示工具按钮
            *   `NodeItem.vue` - 显示单个节点项
            *   `CategoryList.vue` - 显示分类列表
            *   `NodeGallery.vue` - 节点库主组件
            *   `toolPanel.vue` - 作为容器组件集成其他组件
        *   重构后提高了代码可维护性，每个组件有明确的职责
        *   实现了更好的组件复用性，各组件可在其他场景中复用
        *   保留了原有的所有功能和视觉设计
        *   将 CSS 变量移至全局样式，确保设计系统一致性
*   **YYYY-MM-DD (织):** 
    *   全面美化界面设计，提升视觉体验：
        *   建立完整的设计系统，使用 CSS 变量定义颜色、尺寸、阴影和过渡时间
        *   优化色彩搭配，使用更现代的蓝紫色作为主色调
        *   改进卡片和按钮设计，增加微妙的悬浮效果和阴影
        *   添加过渡动画和反馈效果，如点击涟漪、平滑展开收起等
        *   美化节点库面板，优化搜索框、分类标题和节点项的视觉层次
        *   优化排版，使用更合理的间距和字体大小
        *   添加滚动条样式，保持整体美感
*   **YYYY-MM-DD (织):** 
    *   重大功能增强：在保留原有工具栏功能的基础上，增加了完整的节点库功能
    *   新增功能：
        *   底部增加"节点库"按钮，点击可展开/折叠节点列表面板
        *   支持搜索过滤节点
        *   支持按分类展示节点，分类可展开/折叠
        *   支持点击节点项显示详细信息（输入/输出端口、默认值、示例等）
        *   支持拖拽节点，通过 `node-drag-start` 事件与外部交互
    *   当前使用模拟数据 `mockNodeCategories`，实际使用时应替换为真实节点数据
    *   保留原有的响应式布局（网格/列/图标）功能
    *   统一使用 CSS 变量定义样式，提高可维护性
*   **YYYY-MM-DD (织):** 
    *   重构 `toolPanel.vue`，实现响应式布局。
    *   使用 `ResizeObserver` 监测宽度，根据断点 (150px, 80px) 动态切换三种布局模式：网格 (`layout-grid`)、单列卡片 (`layout-column`)、纯图标 (`layout-icon`)。
    *   移除了面板的固定宽度，更新了相关 CSS 样式。
*   **YYYY-MM-DD (织):** 
    *   创建了 `index.vue` 作为面板入口，导入并导出主组件 `toolPanel.vue`。 